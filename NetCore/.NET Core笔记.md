# .NET Core 笔记

## 从CLI开始
CLI（command line interface）

## ASP.NET Core
### 启动 Web App
#### Program.cs
#### Startup.cs

## 依赖注入 Dependency Injection 
IoC(Inversion of Control)容器的职责：  
- 控制系统中所以对象的创建
- 注入正确的依赖
- 管理创建的对象的生命线

有三种方式指定服务的生命周期：  
1. Transient
用作轻量级的服务，不需要保持任何状态，快速实例化，每次需要时都会创建一个类的新实例。  
``` c#
services.AddTransient<IClock,Clock>()
```
2. Scoped
一般是用在那些需要保持状态的服务，这些状态只对当前请求有用，像仓储类和数据访问类。  
作为scoped注册的Services会在请求开始的时候被创建，同一个请求中每次需要这个类的时候都会重用这个实例。  
添加方法：
``` c#
services.AddScoped<IRepository, Repository>()
```
3. Singleton
服务作为单例被注册。服务的实例在第一次需要时被创建，在整个之后的应用程序中都会被重用。这样的Services一般会保存一个应用程序状态，就像内存内缓存或者类似的方式。
``` c#
services.AddSingleton<IApplicationCache, ApplicationCache>().
```
### 使用依赖注入
使用 ASP.NET Core MVC 需要引入Nuget包`Microsoft.AspNetCore.Mvc`

## 环境 Environments
每个应用程序都至少要处理至少2个或更多的环境，如开发环境、生产环境，和一些情况下的模拟环境。  

### 老方式
web.config **IHostingEnvironment**和预处理指令。   
发生在编译阶段。

### 新方式
IHostingEnvironment 接口。  
IHostingEnvironment的实现读取一个指定的名叫**IHostingEnvironment**的环境变量，并检查它的值。如果是**Development**，表示运行在开发环境，以此类推。  
这种方法可以在运行阶段在不同的环境之间切换，而不像老的方式。

Startup类也可以使用约定的命名方式，来标记使用的环境。如当前环境是Development，那么新建一个`StartupDevelopment`类，则`Main`方法中的`.UseStartup<Startup>`，能自动切换不同的类，只要遵循正确的约定（方法名+环境名）。  
同样的约定也适用于`Startup`中的类，如`ConfigureDevelopment`，它也会在`Development`环境中替换原始的方法。  

### 创建自定义的环境
如需要一个`QualityAssurance`的环境，则可以自己扩展`IHostingEnvironment`的方法： 
``` c#
using Microsoft.AspNetCore.Hosting;
namespace Syncfusion.Asp.Net.Core.Succinctly.Environments.Extensions {
public static class HostingEnvironmentExtensions 
{
    public static bool IsQualityAssurance(this IHostingEnvironment hostingEnvironment)
    {
        return hostingEnvironment.EnvironmentName == "QualityAssurance";
    } 
}
```
**IHostingEnvironments**也可以用在视图和配置文件中。  

## 静态文件
安装Nuget包`Microsoft.AspNetCore.StaticFiles`
``` c#
// 使用静态文件，静态文件需要存放在wwwroot文件夹下
app.UseStaticFiles();
```
或
``` c#
// 一个单页应用里，当访问域名时需要返回默认文档（default.html,default.htm,index.html,index.htm)
// 如果不设置UseFileServer，显示一个空白页
app.UseFileServer();    
```

## 错误处理和异常页面
从某种角度来看，你可以说一个好的应用程序要能够在最短的时间内识别错误并将最好的反馈返回给用户。  
日志框架、异常处理、自定义错误页面。  

### 开发者异常页面
安装Nuget包 `Microsoft.AspNetCore.Diagnostics`  
``` c#
if (_env.IsDevelopment())
{
    app.UseDeveloperExceptionPage(); 
} 
else 
{
    app.UseStatusCodePagesWithRedirects("~/errors/{0}.html"); 

    // app.UseStatusCodePagesWithReExecute("~/errors/{0}");     // MVC
}
```

## 配置文件
